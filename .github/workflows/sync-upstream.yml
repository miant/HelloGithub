name: Sync Upstream (Force)

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT }}
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Sync with upstream (force)
        run: |
          # 添加上游仓库
          git remote add upstream https://github.com/521xueweihan/HelloGitHub.git || true
          
          # 获取上游更新
          git fetch upstream
          
          # 记录同步前的 commit
          BEFORE=$(git rev-parse HEAD)
          echo "同步前: $BEFORE"
          
          # ⭐ 强制重置到上游版本（解决冲突）
          git reset --hard upstream/master
          
          # 记录同步后的 commit
          AFTER=$(git rev-parse HEAD)
          echo "同步后: $AFTER"
          
          # 检查是否有更新
          if [ "$BEFORE" != "$AFTER" ]; then
            echo "✅ 检测到上游更新"
            # 强制推送
            git push origin master --force
          else
            echo "ℹ️ 已是最新版本"
          fi